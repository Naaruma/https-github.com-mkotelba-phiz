<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:c="http://www.springframework.org/schema/c"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:lang="http://www.springframework.org/schema/lang"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:task="http://www.springframework.org/schema/task"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd
        http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">
    
    <!--====================================================================================================
    = JSON PROVIDERS
    =====================================================================================================-->
    <beans:bean id="jsonProv" class="net.logstash.logback.composite.JsonProvider" abstract="true"/>
    
    <!--====================================================================================================
    = ENCODERS
    =====================================================================================================-->
    <beans:bean id="encoderLogstash" class="gov.hhs.onc.phiz.logging.logstash.impl.PhizLogstashEncoder" parent="encoder" abstract="true"
        p:encodingCharset-ref="charsetUtf8"
        p:jsonFactoryDecorator-ref="jsonFactoryDecoratorLogstash"
        p:lineSeparator="#{ T(org.apache.commons.lang3.StringUtils).LF }">
        <beans:property name="providerItems">
            <beans:list>
                <beans:bean class="net.logstash.logback.composite.LogstashVersionJsonProvider" parent="jsonProv"/>
                <beans:bean class="net.logstash.logback.composite.loggingevent.CallerDataJsonProvider" parent="jsonProv"/>
                <beans:bean class="net.logstash.logback.composite.loggingevent.LoggerNameJsonProvider" parent="jsonProv"/>
                <beans:bean class="net.logstash.logback.composite.loggingevent.LoggingEventFormattedTimestampJsonProvider" parent="jsonProv"
                    p:timeZone="#{ timeZoneUtc.ID }"/>
                <beans:bean class="net.logstash.logback.composite.loggingevent.LogLevelJsonProvider" parent="jsonProv"/>
                <beans:bean class="net.logstash.logback.composite.loggingevent.LogLevelValueJsonProvider" parent="jsonProv"/>
                <beans:bean class="net.logstash.logback.composite.loggingevent.LogstashMarkersJsonProvider" parent="jsonProv"/>
                <beans:bean class="net.logstash.logback.composite.loggingevent.MessageJsonProvider" parent="jsonProv"/>
                <beans:bean class="gov.hhs.onc.phiz.logging.logstash.impl.PhizMdcJsonProvider" parent="jsonProv">
                    <beans:property name="includeMdcKeyNames">
                        <beans:list>
                            <beans:value>#{ T(gov.hhs.onc.phiz.logging.impl.EventIdMdcConverter).EVENT_ID_MDC_KEY }</beans:value>
                        </beans:list>
                    </beans:property>
                </beans:bean>
                <beans:bean class="net.logstash.logback.composite.loggingevent.StackTraceJsonProvider" parent="jsonProv"
                    p:throwableConverter-ref="throwableProxyConvRootCause"/>
                <beans:bean class="net.logstash.logback.composite.loggingevent.TagsJsonProvider" parent="jsonProv"/>
                <beans:bean class="net.logstash.logback.composite.loggingevent.ThreadNameJsonProvider" parent="jsonProv"/>
            </beans:list>
        </beans:property>
    </beans:bean>
    
    <!--====================================================================================================
    = APPENDERS
    =====================================================================================================-->
    <!--suppress SpringPlaceholdersInspection -->
    <beans:bean id="appenderFileLogstash" parent="appenderFile" destroy-method="stop" init-method="start"
        p:file="${phiz.logging.logstash.file.dir}/${phiz.logging.logstash.file.name}${phiz.logging.logstash.file.name.ext}"
        p:name="fileLogstash">
        <beans:property name="encoder">
            <beans:bean parent="encoderLogstash" destroy-method="stop" init-method="start"/>
        </beans:property>
    </beans:bean>
</beans:beans>